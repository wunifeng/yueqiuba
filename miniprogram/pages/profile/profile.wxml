<!--pages/profile/profile.wxml-->
<view class="profile-container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{isLoading}}">
    <t-loading theme="circular" size="48rpx" />
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- æœªç™»å½•çŠ¶æ€ -->
  <view class="login-container" wx:if="{{!isLoading && !isLoggedIn}}">
    <view class="login-content">
      <view class="login-icon">ğŸ‘¤</view>
      <view class="login-title">æ¬¢è¿ä½¿ç”¨çº¦çƒå°ç¨‹åº</view>
      <view class="login-desc">ç™»å½•åå¯ä»¥å‘å¸ƒæ´»åŠ¨ã€ç”³è¯·å‚ä¸ã€ç®¡ç†ä¸ªäººä¿¡æ¯</view>
      <t-button 
        theme="primary" 
        size="large" 
        bind:tap="onLogin"
        class="login-button"
      >
        å¾®ä¿¡ç™»å½•
      </t-button>
    </view>
  </view>

  <!-- å·²ç™»å½•çŠ¶æ€ -->
  <view wx:if="{{!isLoading && isLoggedIn}}">
    <!-- ç”¨æˆ·ä¿¡æ¯åŒºåŸŸ -->
    <view class="user-section">
      <view class="user-info">
        <view class="user-avatar">
          <image wx:if="{{userInfo.avatar && userInfo.avatar !== 'ğŸ‘¤'}}" 
                 src="{{userInfo.avatar}}" 
                 class="avatar-image" />
          <text wx:else class="avatar-placeholder">{{userInfo.avatar || 'ğŸ‘¤'}}</text>
        </view>
        <view class="user-details">
          <view class="user-name">{{userInfo.nickname}}</view>
          <view class="user-meta">
            <text class="phone" wx:if="{{userInfo.phone}}">{{userInfo.phone}}</text>
            <text class="level">{{userInfo.level}}</text>
          </view>
          <view class="join-date" wx:if="{{userInfo.joinDate}}">åŠ å…¥æ—¶é—´ï¼š{{userInfo.joinDate}}</view>
        </view>
        <view class="user-actions">
          <t-button theme="outline" size="small" bind:tap="onEditProfile">
            ç¼–è¾‘
          </t-button>
        </view>
      </view>

      <!-- ç”¨æˆ·ç»Ÿè®¡ -->
      <view class="user-statistics">
        <view class="stat-item">
          <view class="stat-number">{{userInfo.statistics.publishedCount}}</view>
          <view class="stat-label">å‘å¸ƒçš„</view>
        </view>
        <view class="stat-item">
          <view class="stat-number">{{userInfo.statistics.appliedCount}}</view>
          <view class="stat-label">ç”³è¯·çš„</view>
        </view>
        <view class="stat-item">
          <view class="stat-number">{{userInfo.statistics.joinedCount}}</view>
          <view class="stat-label">å‚ä¸çš„</view>
        </view>
      </view>
    
      <!-- å¿«æ·æ“ä½œ -->
      <view class="quick-actions">
        <view class="action-item" bind:tap="onSettings">
          <t-icon name="setting" size="40rpx" color="#0052d9" />
          <text>è®¾ç½®</text>
        </view>
        <view class="action-item" bind:tap="onContactService">
          <t-icon name="service" size="40rpx" color="#0052d9" />
          <text>å®¢æœ</text>
        </view>
        <view class="action-item" bind:tap="onLogout">
          <t-icon name="logout" size="40rpx" color="#ff4d4f" />
          <text>é€€å‡º</text>
        </view>
      </view>
    </view>

    <!-- TabåŒºåŸŸ -->
    <view class="tabs-section">
      <t-tabs 
        value="{{currentTab}}" 
        bind:change="onTabChange"
        theme="line"
      >
      <t-tab-panel 
        wx:for="{{tabs}}" 
        wx:key="value"
        label="{{item.label}}" 
        value="{{index}}"
      >
        <!-- æ´»åŠ¨åˆ—è¡¨ -->
        <scroll-view class="activity-list" scroll-y>
          <!-- æˆ‘å‘å¸ƒçš„æ´»åŠ¨ -->
          <view wx:if="{{currentTab === 0}}">
            <view class="activity-item" 
                  wx:for="{{publishedActivities}}" 
                  wx:key="id"
                  bind:tap="onActivityTap"
                  data-id="{{item.id}}">
              
              <view class="activity-image">
                <text class="sport-icon">{{item.image}}</text>
              </view>
              
              <view class="activity-info">
                <view class="activity-header">
                  <view class="activity-title">{{item.title}}</view>
                  <view class="activity-status {{item.status}}">{{item.statusText}}</view>
                </view>
                
                <view class="activity-meta">
                  <view class="meta-item">
                    <t-icon name="time" size="24rpx" />
                    <text>{{item.time}}</text>
                  </view>
                  <view class="meta-item">
                    <t-icon name="location" size="24rpx" />
                    <text>{{item.location}}</text>
                  </view>
                </view>
                
                <view class="activity-footer">
                  <text class="participant-count">{{item.participants}}/{{item.maxParticipants}} äºº</text>
                  <view class="action-buttons" wx:if="{{item.status === 'active'}}">
                    <t-button 
                      theme="outline" 
                      size="small" 
                      bind:tap="onEditActivity"
                      data-id="{{item.id}}"
                    >
                      ç¼–è¾‘
                    </t-button>
                    <t-button 
                      theme="outline" 
                      size="small" 
                      bind:tap="onCancelPublish"
                      data-id="{{item.id}}"
                    >
                      å–æ¶ˆ
                    </t-button>
                  </view>
                </view>
              </view>
            </view>
            
            <!-- ç©ºçŠ¶æ€ -->
            <view class="empty-state" wx:if="{{publishedActivities.length === 0}}">
              <t-icon name="activity" size="120rpx" color="#d9d9d9" />
              <text class="empty-text">æš‚æ— å‘å¸ƒçš„æ´»åŠ¨</text>
              <text class="empty-desc">å¿«å»å‘å¸ƒä½ çš„ç¬¬ä¸€ä¸ªæ´»åŠ¨å§</text>
            </view>
          </view>
          
          <!-- æˆ‘ç”³è¯·çš„æ´»åŠ¨ -->
          <view wx:if="{{currentTab === 1}}">
            <view class="activity-item" 
                  wx:for="{{appliedActivities}}" 
                  wx:key="id"
                  bind:tap="onActivityTap"
                  data-id="{{item.id}}">
              
              <view class="activity-image">
                <text class="sport-icon">{{item.image}}</text>
              </view>
              
              <view class="activity-info">
                <view class="activity-header">
                  <view class="activity-title">{{item.title}}</view>
                  <view class="activity-status {{item.status}}">{{item.statusText}}</view>
                </view>
                
                <view class="activity-meta">
                  <view class="meta-item">
                    <t-icon name="time" size="24rpx" />
                    <text>{{item.time}}</text>
                  </view>
                  <view class="meta-item">
                    <t-icon name="location" size="24rpx" />
                    <text>{{item.location}}</text>
                  </view>
                  <view class="meta-item">
                    <t-icon name="user" size="24rpx" />
                    <text>ç»„ç»‡è€…ï¼š{{item.organizer}}</text>
                  </view>
                </view>
                
                <view class="activity-footer">
                  <view class="action-buttons">
                    <t-button 
                      wx:if="{{item.status === 'pending'}}"
                      theme="outline" 
                      size="small" 
                      bind:tap="onWithdrawApplication"
                      data-id="{{item.id}}"
                    >
                      æ’¤å›ç”³è¯·
                    </t-button>
                    <t-button 
                      wx:if="{{item.status === 'rejected'}}"
                      theme="primary" 
                      size="small" 
                      bind:tap="onReapply"
                      data-id="{{item.id}}"
                    >
                      é‡æ–°ç”³è¯·
                    </t-button>
                  </view>
                </view>
              </view>
            </view>
            
            <!-- ç©ºçŠ¶æ€ -->
            <view class="empty-state" wx:if="{{appliedActivities.length === 0}}">
              <t-icon name="user-add" size="120rpx" color="#d9d9d9" />
              <text class="empty-text">æš‚æ— ç”³è¯·è®°å½•</text>
              <text class="empty-desc">å¿«å»ç”³è¯·å‚åŠ æ„Ÿå…´è¶£çš„æ´»åŠ¨å§</text>
            </view>
          </view>
          
          <!-- æˆ‘å‚ä¸çš„æ´»åŠ¨ -->
          <view wx:if="{{currentTab === 2}}">
            <view class="activity-item" 
                  wx:for="{{joinedActivities}}" 
                  wx:key="id"
                  bind:tap="onActivityTap"
                  data-id="{{item.id}}">
              
              <view class="activity-image">
                <text class="sport-icon">{{item.image}}</text>
              </view>
              
              <view class="activity-info">
                <view class="activity-header">
                  <view class="activity-title">{{item.title}}</view>
                  <view class="activity-status {{item.status}}">{{item.statusText}}</view>
                </view>
                
                <view class="activity-meta">
                  <view class="meta-item">
                    <t-icon name="time" size="24rpx" />
                    <text>{{item.time}}</text>
                  </view>
                  <view class="meta-item">
                    <t-icon name="location" size="24rpx" />
                    <text>{{item.location}}</text>
                  </view>
                  <view class="meta-item">
                    <t-icon name="user" size="24rpx" />
                    <text>ç»„ç»‡è€…ï¼š{{item.organizer}}</text>
                  </view>
                </view>
              </view>
            </view>
            
            <!-- ç©ºçŠ¶æ€ -->
            <view class="empty-state" wx:if="{{joinedActivities.length === 0}}">
              <t-icon name="check-circle" size="120rpx" color="#d9d9d9" />
              <text class="empty-text">æš‚æ— å‚ä¸è®°å½•</text>
              <text class="empty-desc">å‚ä¸æ´»åŠ¨åä¼šåœ¨è¿™é‡Œæ˜¾ç¤º</text>
            </view>
          </view>
        </scroll-view>
        </t-tab-panel>
      </t-tabs>
    </view>
  </view>
</view>